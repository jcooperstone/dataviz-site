---
title: "ggplot 102: Facets, Scales, Labels, and Themes (but now üê∂) recitation"
author: "Jessica Cooperstone and you"
date: "9/20/2022"
output:
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
    theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r dogs, fig.alt = "Three dogs looking longingly at the camera as they are about to have dinner. On the left is Nacho, Jess's cream colored French Bulldog, in the middle is Petunia, a black American Staffordshire Terrier, and on the right is Inu, a white and grey Pitbull.", fig.cap= "Nacho (Jess's dog, left) along with his friends Petunia (middle) and Inu (right) waiting for dinner", out.width = "70%", fig.align = "center", echo = FALSE}
knitr::include_graphics("img/dogs.jpg")
```

## Introduction

We will practice what we learned this week in [ggplot102](2_05_themes_labels_facets/05_ggplot102.html) on:

* [Facets](https://ggplot2.tidyverse.org/reference/index.html#facetting)
* [Scales](https://ggplot2.tidyverse.org/reference/index.html#scales)
* [Labels](https://ggplot2.tidyverse.org/reference/index.html#labels)
* [Themes](https://ggplot2.tidyverse.org/reference/index.html#themes)

### Load libraries and data
Before we get started, let's load our libraries and data. Today we will be looking again at some different data from the [Tidy Tuesday project](https://www.tidytuesday.com/) (here is the [Github repo](https://github.com/rfordatascience/tidytuesday/blob/master/data/2022/2022-02-01/readme.md)) about dog breeds.

```{r tidytuesdayR, eval = FALSE}
install.packages("tidytuesdayR")
```


```{r libraries, warning = FALSE, message = FALSE}
library(tidyverse)
library(tidytuesdayR)
```

We will be using the data that is from February 1, 2022, so let's download it. The readme for this data is [here](https://github.com/rfordatascience/tidytuesday/blob/master/data/2022/2022-02-01/readme.md).
```{r}
tuesdata <- tidytuesdayR::tt_load('2022-02-01')
```

Let's look at it.
```{r breed-traits}
glimpse(tuesdata$breed_traits)
```

```{r trait-description}
glimpse(tuesdata$trait_description)
```

```{r}
glimpse(tuesdata$breed_rank)
```

## Investigating
Write code to determine what the 5 most popular dog breeds in 2020 were. There are many ways to do this.

Because each of these datasets has some non-conventional column names, I am going to run `janitor::clean_names()` on each df, and save them in my environment so I won't have to keep using the dollar sign `$` accessor.
```{r}
library(janitor)

breed_traits <- clean_names(tuesdata$breed_traits)
trait_description <- clean_names(tuesdata$trait_description)
breed_rank <- clean_names(tuesdata$breed_rank)
```


```{r}
breed_rank %>%
  filter(x2020_rank <= 5)

breed_rank %>%
  arrange(x2020_rank) %>%
  slice(1:5)
```

What are the 5 most popular and the 5 least popular dogs across this time frame? There are many ways to do this. Hint: create a new variable that is a sum of all the ranks from 2013, allowing a composite score of the popularity of each dog breed across this time period.
```{r}
# most popular
breed_rank %>%
  rowwise() %>%
  mutate(rank_sum = sum(c_across(x2013_rank:x2020_rank))) %>%
  ungroup() %>%
  select(breed, rank_sum, everything()) %>%
  slice_min(n = 5, order_by = rank_sum) # min because here lower sum is more popular

# least popular            
breed_rank %>%
  rowwise() %>%
  mutate(rank_sum = sum(c_across(x2013_rank:x2020_rank))) %>%
  ungroup() %>%
  select(breed, rank_sum, everything()) %>%
  arrange(rank_sum) %>%
  slice_max(n = 5, order_by = rank_sum) # max bc here higher sum is less popular
```

Create a plot where you take the 12 most popular dogs from 2020, and plot their popularity rank from 2013 to 2020. Hint, to facet, you need to have the variable you want to facet in one column.
```{r}
# go from wide to long data or "tidy" data
breed_rank_tidy <- breed_rank %>%
  pivot_longer(cols = x2013_rank:x2020_rank,
              names_to = "year",
              values_to = "rank")

# remove extra character in year
breed_rank_tidy$year <- breed_rank_tidy$year %>%
  str_remove(pattern = "x") %>%
  str_remove(pattern = "_rank")
```

```{r}
# what dogs should I include?
dogs_to_include <- breed_rank_tidy %>%
  filter(year == 2020 & rank <= 12) 

# plot
breed_rank_tidy %>%
  filter(breed %in% dogs_to_include$breed) %>%
  ggplot(aes(x = year, y = rank)) +
    geom_point() +
    facet_wrap(vars(breed))
```

Alter the aesthetics of this plot until you think it looks good.
```{r}
breed_rank_tidy %>%
  filter(breed %in% dogs_to_include$breed) %>%
  ggplot(aes(x = year, y = rank, group = breed)) +
    geom_point() +
    geom_line() +
    facet_wrap(vars(breed)) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 90),
          strip.text = element_text(size = 8),
          panel.grid.major.x = element_blank()) +
    labs(x = "Year",
         y = "Popularity rank among all AKC dogs",
         title = "Popularity of 12 Most Popular AKC Dog Breeds in 2020 from 2013-2020",
         subtitle = "Labrador retrievers are so popular!")
  
```

What dog has jumped in the rankings most from 2013 to 2020? What has dropped the most?
```{r}
breed_rank %>%
  mutate(rank_inc = (x2020_rank - x2013_rank)) %>%
  select(breed, rank_inc, everything()) %>%
  slice_min(n = 1, order_by = rank_inc)

breed_rank %>%
  mutate(rank_inc = (x2020_rank - x2013_rank)) %>%
  select(breed, rank_inc, everything()) %>%
  slice_max(n = 1, order_by = rank_inc)
```

